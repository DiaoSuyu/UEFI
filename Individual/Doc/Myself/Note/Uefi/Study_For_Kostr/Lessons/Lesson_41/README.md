# QEMU System Configuration and Debugging Guide

## Introduction

This document provides detailed instructions on using QEMU with specific configurations, focusing on the `x86_64` architecture. It also covers how to set up debugging and view debug logs in real-time.

## QEMU Command Explanation

The following command is used to启动 the QEMU system in `x86_64` mode with particular device and debugging settings:

```bash
sudo qemu-system-x86_64 \
-drive if=pflash,format=raw,file=OVMF.fd,id=BIOS-OVMF \
-drive file=fat:rw:hda-contents,format=raw,if=ide,index=0 \
-debugcon file:debug.log \
-global isa-debugcon.iobase=0x402 \
-s
```

- `-drive if=pflash,format=raw,file=OVMF.fd,id=BIOS-OVMF`: This option configures a virtual flash drive. The `OVMF.fd` file serves as the firmware for the virtual machine, providing UEFI support. The `if=pflash` indicates it's a flash-based interface, and `id=BIOS-OVMF` gives it an identifier.
- `-drive file=fat:rw:hda-contents,format=raw,if=ide,index=0`: Sets up a virtual hard drive. The `fat:rw:hda-contents` specifies a FAT-formatted disk image with read-write permissions, and `if=ide,index=0` configures it as the first IDE device.
- `-debugcon file:debug.log`: Redirects the debug console output to a file named `debug.log`. This is crucial for capturing debugging information.
- `-global isa-debugcon.iobase=0x402`: Defines the I/O base address for the debug console. The value `0x402` is used here. The reason for this specific value can be found in the `edk2\OvmfPkg\OvmfPkg.dec` file. According to the documentation therein:

```dec
## This flag is used to control the destination port for PlatformDebugLibIoPort
gUefiOvmfPkgTokenSpaceGuid.PcdDebugIoPort|0x402|UINT16|4
```

This indicates that `0x402` is set as the destination port for the platform debug library I/O port, as defined in the UEFI OVMF package's token space.

- `-s`: Short for `-gdb tcp::1234`, it enables the GDB server on port `1234`, allowing remote debugging.

## Viewing Logs in Real-Time

To have the debug log display in real-time in a separate terminal window, follow these steps:

1. Open another terminal window within the same folder as where the QEMU command is being executed.
2. Enter the following command:

```bash
tail -f debug.log
```

The `-f` option in the `tail` command stands for "follow." It continuously monitors the `debug.log` file for new content and displays it as it is appended. This way, you can observe the debug messages generated by the QEMU system in real-time, which is extremely useful for debugging purposes, such as tracking the system's boot process, device initialization, or any runtime errors.

By following these steps, you can effectively set up and monitor a QEMU-based virtual environment for development and debugging tasks.

 ![debug.png](Log\debug.png "debug.png")
